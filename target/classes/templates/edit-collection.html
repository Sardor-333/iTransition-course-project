<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/head :: head"></head>

<body>
<div class="wrapper">

    <div th:replace="fragments/sidebar :: sidebar"></div>

    <header th:replace="fragments/header :: header"></header>

    <div class="page-wrapper">
        <div class="page-content">

            <h1>Create new collection</h1>

            <div id="response"></div>

            <form id="create-collection-form" th:action="@{'/api/v1/collections/edit/' + ${collection.id}}"
                  method="post" enctype="multipart/form-data">
                <input type="hidden" id="collectionId" th:value="${collection.id}">
                <div class="row">

                    <!-- Collection img -->
                    <img th:src="${collection.imgUrl}" alt="Img" class="rounded mx-auto d-block">

                    <!-- Collection name -->
                    <div class="col">
                        <label for="collectionName">Edit collection name</label>
                        <input id="collectionName" name="name" type="text" class="form-control"
                               th:value="${collection.name}">
                    </div>

                    <!-- Collection photo -->
                    <div class="col">
                        <label for="collectionImg" th:if="${collection.imgUrl != null}">Upload new img</label>
                        <label for="collectionImg" th:if="${collection.imgUrl == null}">Upload img</label>
                        <input name="collectionImg" id="collectionImg" type="file" class="form-control">
                    </div>
                </div>
                <div class="row">

                    <!-- Description -->
                    <div class="col">
                        <label for="collectionDescription">Edit description</label>
                        <textarea name="description" class="form-control" id="collectionDescription" rows="3"
                                  th:text="${collection.description}"></textarea>
                    </div>

                    <!-- Topics -->
                    <div class="col">
                        <label for="topicId">Edit topic</label>
                        <select id="topicId" name="topicId" class="form-control">
                        </select>
                    </div>
                </div>

                <a class="btn btn-primary" id="submit-form-button">Submit form</a>
            </form>
        </div>
    </div>
</div>

<!-- Theme Customizer -->
<div th:replace="fragments/theme-customizer :: theme-customizer"></div>

<!-- Load topics -->
<script th:inline="javascript">
    // WHEN WINDOW LOADS LOAD ALL TOPICS
    window.onload = () => {
        loadTopics();
    }

    function loadTopics() {
        // EXTRACT CURRENT TOPIC FROM MODEL
        let selectedTopicId=[[${collection.topic.id}]];
        console.log('=== COLLECTION TOPIC ID === ' + selectedTopicId);

        fetch('/api/v1/topics', {
            method: 'get'
        }).then(response => {
            response.json()
                .then(topics => {
                    const select = document.getElementById('topicId');

                    for (let i = 0; i < topics.length; i++) {
                        const currTopic = topics[i];

                        const opt = document.createElement('option');
                        opt.value = currTopic.id;
                        opt.text = currTopic.name;
                        if (currTopic.id === selectedTopicId) opt.selected=true;

                        select.appendChild(opt);
                    }
                })
        })
    }
</script>

<script th:src="@{/assets/js/custom/edit-collection.js}"></script>
<script th:src="@{/assets/js/bootstrap.bundle.min.js}"></script>
<script th:src="@{/assets/js/jquery.min.js}"></script>
<script th:src="@{/assets/plugins/simplebar/js/simplebar.min.js}"></script>
<script th:src="@{/assets/plugins/metismenu/js/metisMenu.min.js}"></script>
<script th:src="@{/assets/plugins/perfect-scrollbar/js/perfect-scrollbar.js}"></script>
<script th:src="@{/assets/js/app.js}"></script>

<script th:src="@{/webjars/jquery/jquery.min.js}"></script>
<script th:src="@{/webjars/popper.js/umd/popper.min.js}"></script>
<script th:src="@{/webjars/bootstrap/js/bootstrap.min.js}"></script>
</body>

</html>